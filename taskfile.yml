version: '3'

dotenv: ['{{.USER_WORKING_DIR}}/.env']
  
tasks:
  newProj:
    requires:
      vars:
      - name: NAME
    cmds:
      - '[ -d "{{ .HOME }}/VTB_PROJECTS/" ] || mkdir -p "{{ .HOME }}/VTB_PROJECTS/"'
      - docker run -rm -it -v {{ .HOME }}/VTB_PROJECTS/:/VTB_PROJECTS/ --user $(id -u):$(id -g) vtb:v0 new proj -n {{.NAME}}

  build:
    cmds:
      - docker build -t vtb:v0 {{.USER_WORKING_DIR}}

  openContainer:
    cmds:
      - docker run -rm -it -v {{ .HOME }}/VTB_PROJECTS/:/VTB_PROJECTS/ --entrypoint /bin/bash --user $(id -u):$(id -g) vtb:v0 {{.CLI_ARGS}}

  import:
    requires:
      vars:
      - name: PROJECTNAME
      - name: PROJECTSHOME
    cmds: 
      - |
        "docker run -rm -it \
        --user $(id -u):$(id -g) \
        -v {{ .HOME }}/VTB_PROJECTS/:/VTB_PROJECTS \
        -e {{ .PROJECTSHOME }}=/VTB_PROJECTS \
        -e {{ .PROJECTNAME }}={{ .PROJECTNAME }} vtb:v0 import dut {{.CLI_ARGS}}"

  dockerPush:
    cmds:
      - docker push catbotminion2/vtb:v0

  dockerPull:
    cmds:
      - docker pull catbotminion2/vtb:v0